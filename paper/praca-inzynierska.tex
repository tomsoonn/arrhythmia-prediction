\documentclass[polish,12pt]{aghthesis}
% \documentclass[english,12pt]{aghthesis} dla pracy w jêzyku angielskim. Uwaga, w przypadku strony tytu³owej zmiana jêzyka dotyczy tylko kolejno¶ci wersji jêzykowych tytu³u pracy. 

% Szablon przystosowany jest do druku dwustronnego. 

\usepackage[latin2]{inputenc}
\usepackage{url}
\usepackage{indentfirst}
\usepackage{graphicx}
\usepackage{float}
\usepackage{listings}
\usepackage{color}

%\renewcommand{\arraystretch}{1.2}
\renewcommand{\lstlistingname}{Fragment}

\lstdefinestyle{custompy}{
	language=python,
	tabsize=4,
	basicstyle=\footnotesize,
	keywordstyle=\color{blue},
	breaklines=true,
	frame=single,
	showstringspaces=false,
	breakatwhitespace=true,
	xleftmargin=\parindent,
	belowskip=\baselineskip
}

\lstset{captionpos=b, style=custompy}

\author{Konrad Dobro¶, Tomasz Nizio}

\titlePL{System do predykcji arytmii serca za pomoc± metod uczenia maszynowego}
\titleEN{System for predicting cardiac arrhythmia using machine learning methods}

\fieldofstudy{Informatyka}

\supervisor{dr in¿.\ Marcin Orchel}

\date{\the\year}


\begin{document}

\maketitle

\tableofcontents
\newpage

%TODO streszczenie

\section{\SectionTitleProjectVision}
\label{sec:cel-wizja}
\subsection{Charakterystyka problemu}

% Czym jest arytmia
Arytmia serca jest to stan, w którym praca serca jest nieregularna, a czêstotliwo¶æ wychodzi poza zakres 60-100 uderzeñ na minutê bez przyczyny zewnêtrznej. Stan taki mo¿e stanowiæ zagro¿enie dla ¿ycia, chocia¿ nie jest to regu³±. 
Stan w którym tempo bicia serca wynosi ponad 100 uderzeñ na minutê nazywany jest tachykardi±. D³u¿sza praca serca w przyspieszonym rytmie mo¿e prowadziæ do szkodliwych efektów. Tachykardia mo¿e byæ odczuwana jako nieprzyjemne i mocne bicie serca popularnie okre¶lane ko³ataniem.
Zbyt wolny rytm pracy serca, który wynosi poni¿ej 50 uderzeñ na minutê nazywany jest bradykardi±. Zazwyczaj stan ten nie zagra¿a ¿yciu, choæ mo¿e powodowaæ niepo¿±dane objawy.
% TODO ¼ród³o: wikipedia

% EKG
Najczê¶ciej stosowan± metod± diagnozowania arytmii jest elektrokardiogram - zapis elektrycznej czynno¶ci serca. Pozwala on dok³adnie okre¶liæ rodzaj arytmii, a wiêc i jej szkodliwo¶æ oraz potencjalne przyczyny. W wypadku krótkotrwa³ych arytmii stosuje siê monitory holterowskie umo¿liwiaj±ce ca³odobowe monitorowanie pracy serca.

W wypadku krótkotrwa³ych arytmii stosuje siê monitorowanie pracy serca przez ca³± dobê. Podej¶cie takie produkuje ogromn± ilo¶æ danych, do analizy której potrzebna jest specjalistyczna wiedza, a rêczne oznaczenie danych jest bardzo czasoch³onne. Obecnie w procesie tym wykorzystywane s± metody matematyczne, które wykorzystuj± w bardzo ograniczonym zakresie wiedzê dziedzinow± i wymagaj± bardzo uwa¿nego nadzorowania.

% Jaka jest potrzeba
Istnieje potrzeba zautomatyzowania procesu wykrywania arytmii w wiêkszym stopniu i za pomoc± bardziej niezawodnych metod, które wykorzystywa³yby wiedzê dziedzinow±. Proces ten dodatkowo mo¿e byæ usprawniony przez system predykcji wyst±pienia arytmii, który umo¿liwia³by wcze¶niejsze wykrywanie arytmii i reagowanie na jej potencjalne wyst±pienie z wyprzedzeniem. Umo¿liwi³oby to znaczne ograniczenie kosztownego czasu pracy lekarzy i mog³oby zwiêkszyæ jej efektywno¶æ. Poniewa¿ problem ten wymaga posiadania wiedzy dziedzinowej do rozwi±zania bardzo obiecuj±cym podej¶ciem jest wykorzystanie metod uczenia maszynowego. Metody te mog± "uczyæ"\ siê wiedzy specjalistycznej z oznaczonych danych. Jest to szczególnie przydatne, gdy wiedza ta jest ciê¿ka do reprezentacji za pomoc± klasycznych metod, ze wzglêdu na czynniki takie jak du¿a ilo¶æ danych wej¶ciowych, brak jasnych powi±zañ miêdzy danymi czy konieczno¶æ reprezentacji ludzkiego rozumowania.

\subsection{Motywacja projektu}

Podstawow± motywacj± do stworzenia takiego produktu by³ brak podobnych rozwi±zañ dostêpnych obecnie na rynku oraz chêæ rozwijania siê w tematyce uczenia maszynowego.
Bardzo ma³o jest materia³ów dotycz±cych problematyki naszego projektu, który mo¿e staæ podstaw± dla polepszenia zdrowia oraz pozwoli na wcze¶niejsze wykrywanie powa¿niejszych schorzeñ. Nasze rozwi±zanie mo¿e siê przydaæ osobom, które s± zagro¿one arytmi± i obawiaj± siê o swoje zdrowie. Ponadto stworzenie takiego programu pozwoli nam poszerzyæ wiedzê w dziedzinie uczenia maszynowego, które staje siê coraz popularniejsze. W naszym projekcie zdecydowali¶my siê wykorzystaæ sieæ neuronow±, co wydaje siê byæ bardzo ciekawym pomys³em. Coraz wiêcej siê o niej s³yszy oraz technologia to jest coraz lepiej rozwijana i udoskonalana. Rozwi±zanie takie ma bardzo du¿y potencja³, jednak pojawiæ siê mog± te¿ liczne problemy ze stworzeniem takiego systemu. Bardzo wa¿n± kwesti±, je¿eli chodzi o nasz projekt jest odpowiednio oznaczona i du¿a baza danych.
Sieæ neuronowa aby uzyskaæ skuteczno¶æ musi zostaæ wytrenowana na odpowiedniej ilo¶ci danych. Dodatkowo dane te musz± byæ szczegó³owo oznakowane. Jako ¿e nie ma podobnych rozwi±zañ na rynku, nie mamy te¿ pewno¶ci ¿e mo¿liwe jest skuteczne przewidywanie arytmii.

\subsection{Wizja produktu}

Celem naszego projektu jest stworzenie aplikacji na komputery z systemem Windows, wykorzystuj±c± sieæ neuronow± do przewidywania wyst±pienia arytmii serca. Program po odpowiednim przetrenowaniu na zbiorze danych ma byæ w stanie przewidywaæ mo¿liwe nieprawid³owo¶ci w dzia³aniu serca z wyprzedzeniem. U¿ytkownik bêdzie móg³ odczytywaæ predykcje dostarczone przez algorytm. Mo¿liwe równie¿ bêdzie wy¶wietlanie wykresów EKG oraz zarz±dzanie nimi, jak i odczytanie z nich oznaczeñ wyst±pienia arytmii. Docelowo program ma umo¿liwiaæ monitorowanie i analizowanie w czasie rzeczywistym. Aplikacja bêdzie mia³a klasyczny wygl±d aplikacji Windows z menu w górnej czê¶ci. Przebieg wykresu bêdzie mo¿na przewijaæ na pasku, a oznaczenia bêd± obecne pod nim.

\subsection{Studium wykonalno¶ci}

% Jak z³o¿ony jest problem
Projekt ma skomplikowan± problematykê, g³ównie ze wzglêdu na ma³± ilo¶æ badañ i publicznych publikacji na ten temat. Dodatkowo problem jest interdyscyplinarny, obejmuj±c w swoim zakresie zagadnienia informatyczne, jak i zagadnienia zwi±zane z medycyn±. Z tego wzglêdu konieczne jest uwa¿ne przestudiowanie wiedzy dziedzinowej, z któr± autorzy nie s± zaznajomieni, a które do pe³nego zrozumienia wymaga osobnych studiów.

Ze wzglêdu na konieczno¶æ posiadania wiedzy dziedzinowej jako wykorzystywan± metodê uczenia maszynowego zosta³a wybrana sieæ neuronowa. Umo¿liwi to wykorzystanie baz danych wykresów EKG ju¿ oznaczonych przez specjalistów z wymagan± wiedz± dziedzinow±. Sieci neuronowe dziêki algorytmom propagacji wstecznej mog± "nauczyæ"\ siê reprezentacji wiedzy dziedzinowej z danych bez wymagania tej wiedzy, i mo¿liwo¶ci jej bezpo¶redniego prze³o¿enia na algorytm, przez implementatora.

Dodatkowo ma³a ilo¶æ dostêpnych publicznie publikacji w zakresie rozwi±zywanego problemu dyktuje wybór technologi. W trakcie wykonywania projektu konieczne jest przetestowanie wielu ró¿nych sposobów rozwi±zania i przeprowadzanie eksperymentów w celu okre¶lenia formy ostatecznego produktu. W sytuacji tej najlepiej sprawdzaj± siê iteracyjne modele organizacyjne, umo¿liwiaj±ce czêst± aktualizacjê projektu do zmieniaj±cych siê mo¿liwo¶ci pozyskanych z eksperymentów i zwi±zanych z nimi wymagañ. Podej¶cie takie umo¿liwia równie¿ stopniowe rozszerzanie funkcjonalno¶ci systemu. Ze wzglêdu na brak informacji czy przewidywanie wszystkich rodzajów arytmii jest mo¿liwe, system bêdzie stopniowo rozszerzany o bardziej szczegó³owe analizy na podstawie wyników prototypów i eksperymentów.

Jako jêzyk implementacji systemu wybrany zosta³ Python ze wzglêdu na du¿± ilo¶æ dostêpnych technologi do pracy sieciami neuronowymi oraz jego du¿± ekspresywno¶æ. Cechy te bardzo dobrze komponuj± siê z modelem wykonywania projektu zmniejszaj±c znacznie czas potrzebny na przetestowanie ró¿nych rozwi±zañ i umo¿liwiaj±c elastyczniejsze podej¶cie do problemu.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.9\linewidth]{mitdb.jpg}
	\caption{Fragment oznaczonych danych EKG z bazy MIT-BIH}
	\label{fig:mitdb}
\end{figure}

Do implementacji modelu analizy wykresów i sieci neuronowych wybrany zosta³ zestaw technologi Keras + Tensorflow. Umo¿liwia on bardzo ³atwe tworzenie sieci neuronowych, co jeszcze bardziej zmniejsza czas potrzebny na przetestowanie ró¿nych architektur sieci. S± to aktywnie rozwijane technologie posiadaj±ce bardzo rozleg³e mo¿liwo¶ci, a przy tym posiadaj± szczegó³owe dokumentacje. Dodatkowo biblioteki te s± szeroko wykorzystywane w profesjonalnych rozwi±zaniach co prowadzi do du¿ej liczby dostêpnych informacji i aktywnego wsparcia.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{keras-tensor.jpg}
	\caption{Technologie uczenia maszynowego}
	\label{fig:kt}
\end{figure}

Jako technologiê do implementacji aplikacji i interfejsu u¿ytkownika wybrana zosta³a biblioteka PySide2, dostarczaj±ca interfejs dla jêzyka Python do biblioteki Qt. Dziêki temu dostêpna jest rozleg³a dokumentacja, której brakuje w innych rozwa¿anych bibliotekach dla jêzyka Python. Dodatkowo jest to biblioteka aktywnie rozwijana w przeciwieñstwie do przestarza³ej biblioteki dostêpnej domy¶lnie w jêzyku Python - Tkinter. Inn± rozwa¿an± opcj± by³a biblioteka PyQt, jednak nie zosta³a ona finalnie wybrana, gdy¿ posiada zbyt restrykcyjn± licencjê GPL.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.6\linewidth]{pyside.jpg}
	\caption{Biblioteka do interfejsu graficznego}
	\label{fig:pyside}
\end{figure}

Podsumowuj±c projekt niesie ze sob± du¿± ilo¶æ wyzwañ i niewiadomych. Z tego wzglêdu wybrany zosta³ model iteracyjny i szereg elastycznych technologii wspieraj±cych takie podej¶cie. Wszystkie podjête decyzje organizacyjne i technologiczne maj± na celu zmniejszenie ryzyka i odpowiednie reagowanie na napotkane problemy. Umo¿liwia to okre¶lenie, ¿e projekt jako ca³o¶æ z du¿ym prawdopodobieñstwem zostanie wykonany, a wszelkie powa¿niejsze zagro¿enia ograniczone bêd± do poszczególnych funkcjonalno¶ci i modu³ów.

\subsection{Analiza zagro¿eñ}

Podczas tworzenia aplikacji przewiduj±cej wyst±pienie arytmii przy u¿yciu sieci neuronowej w ma³ym zespole istnieje wiele zagro¿eñ, wymienionych poni¿ej:

\begin{itemize}
\item Brak wiedzy dziedzinowej - jako studenci informatyki nie posiadamy ¿adnej wiedzy z zakresu medycyny i chorób serca, nie wiemy szczegó³owo jak dzia³a ludzki organizm oraz jak pracuje narz±d, który pompuje krew w jego wnêtrzu. Mo¿e to bardzo utrudniæ pracê oraz prowadziæ do pewnych b³êdów w rozumowaniu.

\item Brak wystarczaj±cej ilo¶ci danych - potrzebujemy du¿ej ilo¶ci danych aby program móg³ siê nauczyæ przewidywaæ arytmie. Dodatkowo dane te musz± byæ dok³adnie oznaczone, gdy¿ nie jeste¶my w stanie zrobiæ tego sami, a bardzo ciê¿ko o takie dane.

\item Niewystarczaj±ca skuteczno¶æ sieci neuronowej - mo¿e siê okazaæ ¿e nie jeste¶my w stanie uzyskaæ skuteczno¶ci która by³aby satysfakcjonuj±ca, byæ mo¿e nie ma specjalnych prawid³owo¶ci które pozwoli³yby przewidywaæ nieprawid³owo¶ci w pracy serca lub sieæ neuronowa nie poradzi sobie z tak skomplikowanym problemem.

\item Ró¿norodno¶æ typów arytmii - rodzajów arytmii jest wiele, nie wszystkie s± dok³adnie zbadane i opisane. Prawdopodobnie niektórych nie da siê przewidzieæ i nie bêdziemy mogli braæ wszystkich pod uwagê.
\end{itemize}
%\emph{Charakterystyka problemu, motywacja projektu (w tym przegl±d
%istniej±cych rozwi±zañ prowadz±ca do uzasadnienia celu prac),
% wizja produktu, studium wykonalno¶ci i analiza zagro¿eñ.}

\section{\SectionTitleScope}
\label{sec:zakres-funkcjonalnosci}
\subsection{Charakterystyka u¿ytkowników systemu}

W naszym systemie wyró¿nia siê tylko jednego g³ównego u¿ytkownika. Korzysta on z programu na platformê Windows i ma dostêp do wszystkich funkcjonalno¶ci dostarczanych przez produkt.

\subsection{Wymagania funkcjonalne}

Wymagania funkcjonalne zosta³y przedstawione za pomoc± historyjek u¿ytkownika (ang. user stories), które okre¶laj± co u¿ytkownik chcê zrobiæ za pomoc± systemu i w jakim celu.

\begin{itemize}
	\item Chcê wy¶wietliæ zapisany wykres EKG ¿eby go przeanalizowaæ
	\item Chcê zobaczyæ wykres EKG aktualizowany w czasie rzeczywistym ¿eby na bie¿±co widzieæ jego zmiany i wyniki analizy
	\item Chcê zobaczyæ oznaczenia poszczególnych uderzeñ serca ¿eby lepiej zorientowaæ siê w wykresie i ³atwiej odnale¼æ interesuj±ce fragmenty
	\item Chcê zobaczyæ oznaczenia wykrytej arytmii serca ¿eby zlokalizowaæ poszczególne epizody oraz móc ³atwiej je przeanalizowaæ
	\item Chcê zobaczyæ podstawowe informacjê o poszczególnych arytmiach ¿eby lepiej zrozumieæ wyniki analizy i odpowiednio na nie zareagowaæ
	\item Chcê zobaczyæ wyniki predykcji arytmii w przysz³o¶ci ¿eby odpowiednio wcze¶niej zareagowaæ na spodziewane nieprawid³owo¶ci
\end{itemize}

\subsection{Wymagania niefunkcjonalne}

Wymagania aplikacji:

\begin{itemize}
	\item Musi dzia³aæ na systemach Windows
	\item Interfejs musi byæ intuicyjny, przejrzysty i dostarczaæ wszystkich wymaganych informacji
	\item Wy¶wietlane wykresy musz± byæ skalowalne
\end{itemize}

Wymagania technologiczne:

\begin{itemize}
	\item Musi istnieæ prosty sposób rozszerzania systemu o nowe formaty zapisu wykresów EKG
	\item System musi umo¿liwiaæ proste rozszerzanie o nowe metody analizy, w tym o ró¿ne algorytmy wykrywania i predykcji
\end{itemize}

\section{\SectionTitleRealizationAspects}
\label{sec:wybrane-aspekty-realizacji}
\emph{Przyjête za³o¿enia, struktura i zasada dzia³ania systemu,
  wykorzystane rozwi±zania technologiczne wraz z uzasadnieniem
  ich wyboru, istotne mechanizmy i zastosowane algorytmy.} % niniejsza linijka to tylko komentarz, który nale¿y usun±æ

Projekt zosta³ podzielony na 3 g³ówne modu³y : 

\begin{itemize}
	\item interface - jest w pe³ni odpowiedzialny za interfejs graficzny
	\item model - zawiera wszystkie elementy dotycz±ce przetwarzania danych oraz predykcji
	\item experimental - znajduje siê w nim kod odpowiedzialny za testowanie i trenowanie ró¿nych konfiguracji sieci neuronowych
\end{itemize}

\subsection{Interfejs}

Interfejs graficzny sk³ada siê na 5 widoków: g³ówne menu, okno predykcji, okno logów predykcji, okno do przegl±dania wykresów EKG oraz okno z mikro-bibliotek± zawieraj±c± informacje o uwzglêdnionych typach arytmii. Ka¿dym widokiem zajmuje siê osobna klasa, a wszystkimi widokami zarz±dza manager. Widoki zosta³y czê¶ciowo stworzone przy pomocy programu Qt Designer i zapisane w plikach formatu .ui. S± one ³adowane z tych plików, a nastêpnie odpowiednio modyfikowane ju¿ w kodzie.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{interface_class_diagram.png}
	\caption{Diagram klas modu³u interface}
	\label{fig:interface_diagram_class}
\end{figure}

\begin{lstlisting}[caption={Kod managera widoków}]
class ViewManager(QStackedWidget):

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.menu = MenuWindow(self, load_ui('resources/menu.ui'))
        self.predict = PredictWindow(self, load_ui('resources/predict.ui'), load_ui('resources/logs.ui'))
        self.types = TypesWindow(self, load_ui('resources/types.ui'))
        self.explore = ExploreWindow(self, load_ui('resources/explore.ui'))

        self.addWidget(self.menu.window)
        self.addWidget(self.predict.window)
        self.addWidget(self.types.window)
        self.addWidget(self.explore.window)

        self.resize(1100, 700)
        self.setWindowTitle("Arrhythmia prediction")
        self.show()

    def show_menu(self):
        self.setCurrentWidget(self.menu.window)

    def show_predict(self):
        self.setCurrentWidget(self.predict.window)

    def show_types(self):
        self.setCurrentWidget(self.types.window)

    def show_explore(self):
        self.setCurrentWidget(self.explore.window)

    def closeEvent(self, event):
        self.explore.closeEvent()
        self.predict.closeEvent()
        
\end{lstlisting}

% mo¿na ewentualnie dodaæ przk³adowy plik .ui czy screena z QtDesigner

\subsubsection{G³ówne menu}

Menu jest bardzo proste. Zawiera 4 przyciski i pozwala prze³±czaæ siê pomiêdzy g³ównymi widokami. Ka¿dy z tych widoków umo¿liwia powrót do g³ównego menu.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.3\linewidth]{menu.jpg}
	\caption{G³ówne menu programu}
	\label{fig:menu}
\end{figure}

\subsubsection{Okno predykcji}

Podstawowe i najwa¿niejsze okno w programie. Umo¿liwia ono wczytanie danych EKG z pliku w formacie .dat(domy¶lny format bazy MIT-BIH z której korzystamy). Na podstawie wczytanych danych generowany jest wykres podgl±du. Wykres jest skalowany do aktualnie wy¶wietlanych danych, tak aby by³y one dobrze widoczne. Nad nim znajduje siê pasek nawigacyjny umo¿liwiaj±cy: przeskok do wybranego fragmentu poprzez wpisanie warto¶ci pocz±tkowej wykresu, przewijanie wstecz lub do przodu oraz odtwarzanie danych w przód co pozwala symulowaæ dzia³anie w czasie rzeczywistym.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.9\linewidth]{navigation.jpg}
	\caption{Pasek do nawigacji po wykresie}
	\label{fig:navigation}
\end{figure}

Poni¿ej wykresu znajduje siê pasek wy¶wietlaj±cy warto¶ci, które na wyj¶ciu daje model predykcji dla aktualnych danych. Rozwa¿amy 4 typy arytmii o oznaczeniach: SVEB, VEB, F oraz Q.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{prediction.jpg}
	\caption{Widok okna predykcji}
	\label{fig:prediction}
\end{figure}

Dodatkowo na dole znajduje siê przycisk, który umo¿liwia otworzenie okna zawieraj±ce logi wszystkiego co siê do tej pory dzia³o w zak³adce dotycz±cej predykcji. Dodatkowo w oknie mamy mo¿liwo¶æ wyczyszczenia dotychczasowej historii oraz zapisania jej do pliku tekstowego.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\linewidth]{logs.jpg}
	\caption{Okno wy¶wietlaj±ce logi programu}
	\label{fig:logs}
\end{figure}

\subsubsection{Przegl±danie danych}

W oknie tym mamy mo¿liwo¶æ przegl±dania bardziej szczegó³owych danych. Umo¿liwia wczytanie danych z plików wraz z informacjami na temat poszczególnych uderzeñ. Na podstawie danych generowany jest wykres na którym ka¿de uderzenie jest oznaczone w odpowiedni sposób. Pasek nawigacyjny dzia³a w taki sam sposób jak w oknie dotycz±cym predykcji i umo¿liwia swobodne przegl±danie danych.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth]{explore.jpg}
	\caption{Okno do przegl±dania oznaczonych danych}
	\label{fig:explore}
\end{figure}

\subsubsection{Dodatkowe informacje}

Jest to dodatkowe okno, bêd±ce ma³± bibliotek± rozwa¿anych przez nas typów arytmii. Z lewej strony mamy listê zawieraj±c± rodzaje nieprawid³owo¶ci. Po wybraniu elementu z listy po prawej stronie zostan± wy¶wietlone odpowiednie informacje. Dane wczytywane s± z plików tekstowych.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{types.jpg}
	\caption{Okno z informacjami na temat ró¿nych typów arytmii}
	\label{fig:types}
\end{figure}

\subsection{Model}

%TODO

\subsection{Eksperymenty}

\subsubsection{Baza treningowa}

Jako bazê treningow± wykorzystali¶my ogólnodostêpn± bazê danych EKG z oznaczonymi danymi - MIT-BIH Arrhythmia Database. Baza ta zawiera 48 pó³-godzinnych, 2 kana³owych zapisów EKG. 23 rekordy zosta³y wybrane losowo ze zbioru 4000 24-godzinnych nagrañ. Pozosta³e 25 rekordów zosta³ wybranych z tego samego zbioru, jednak zawieraj±cych rzadsze, ale równie¿ klinicznie istotne przypadki arytmii.

Rekordy zosta³y zapisane z czêstotliwo¶ci± 360 próbek na sekundê, dla ka¿dego z kana³ów z 11 bitow± rozdzielczo¶ci± w zakresie 10mV. Ka¿de nagranie zosta³o niezale¿nie oznaczone przez 2 lub wiêcej kardiologów. Sprzeczno¶ci zosta³y rozwi±zane w taki sposób aby uzyskaæ czytelne komputerowo referencje dla ka¿dego uderzenia znajduj±cego siê w bazie. W przybli¿eniu jest to 110,00 oznaczeñ w ca³ej bazie.
%TODO ¼ród³o: MIT-BIH

Dla ka¿dego rekordu w bazie znajduj± siê 3 pliki:

\begin{itemize}
	\item plik .dat zawieraj±cy warto¶ci kolejnych próbek
	\item plik .atr zawieraj±cy oznaczenie typu arytmii oraz miejsce jej wyst±pienia na przebiegu EKG
	\item plik .hea zawieraj±cy nag³ówek opisuj±cy format danych
\end{itemize}

Do pobrania danych z sieci wykorzystali¶my gotow± bibliotekê wfdb napisan± w jêzyku Python, która umo¿liwia w bardzo prosty sposób pobranie ca³ej bazy.

\subsubsection{Typy arytmii}

Baza MIT-BIH zawiera dane z oznaczeniami 15 ró¿nych typów uderzeñ serca. Jest to zbyt du¿a ilo¶æ, aby uwzglêdniaæ je wszystkie. Postanowili¶my wiêc zastosowaæ standard AAMI i przekszta³ciæ dane w odpowiedni sposób.

Zawêzi³o to zbiór typów uderzeñ do 5:

\begin{itemize}
	\item N - Normal beat
	\item SVEB- Supraventricular ectopic beat
	\item VEB - Ventricular ectopic beat
	\item F - Fusion
	\item Q - Unknown beat
\end{itemize}

\begin{lstlisting}[caption={Kod mapuj±cy oznaczenia z bazy MIT-BIH do standardu AAMI}]
mapping = {
	BeatType('N', 'Normal beat'): {'N', 'L', 'R'},
	BeatType('SVEB', 'Supraventricular ectopic beat'): {'e', 'j', 'A', 'a', 'J', 'S'},
	BeatType('VEB', 'Ventricular ectopic beat'): {'V', 'E'},
	BeatType('F', 'Fusion'): {'F'},
	BeatType('Q', 'Unknown beat'): {'/', 'f', 'Q'}
	}

def mit_to_aami(symbol):
	for key, value in mapping.items():
		if symbol in value:
			return key
	return None
	
\end{lstlisting}
 
\subsubsection{Podzia³ danych}

Aby w pe³ni wykorzystaæ dane znajduj±ce siê w bazie, ka¿dy rekord jest dzielony na fragmenty o okre¶lonej d³ugo¶ci, wybierane co okre¶lony krok czasowy. W ten sposób otrzymujemy wiele unikalnych fragmentów stanowi±cych podci±gi ca³ego rekordu

\begin{lstlisting}[caption={Funkcja dziel±cy rekordy na fragmenty}]
def slice_records(records, pred_len, post_len, increment=360*60, check_pred=True):
    for record in records:
        for start in range(0, len(record[0]) - pred_len - post_len, increment):
            pred_end = start + pred_len
            post_end = pred_end + post_len
             pred = record[0][start:pred_end]
            post = record[0][pred_end:post_end]
             pred_inds = np.logical_and(start <= record[1], record[1] < pred_end)
            post_inds = np.logical_and(pred_end <= record[1], record[1] < post_end)
            if check_pred:
                pred_labels = record[2][pred_inds]
                if np.all(pred_labels == 'N'):
                    pred_result = pred, record[1][pred_inds], pred_labels
                    post_result = post, record[1][post_inds], record[2][post_inds]
                    yield pred_result, post_result
            else:
                pred_result = pred, record[1][pred_inds], record[2][pred_inds]
                post_result = post, record[1][post_inds], record[2][post_inds]
                yield pred_result, post_result

\end{lstlisting}

%TODO KD Kfold

\subsection{Testy}

%TODO

\section{\SectionTitleWorkOrganization}
\label{sec:organizacja-pracy}
\emph{Struktura zespo³u (role poszczególnych osób), krótki opis i
  uzasadnienie przyjêtej metodyki i/lub kolejno¶ci prac, planowane i
  zrealizowane etapy prac ze wskazaniem udzia³u poszczególnych
  cz³onków zespo³u, wykorzystane praktyki i narzêdzia w zarz±dzaniu
  projektem.}  % niniejsza linijka to tylko komentarz, który nale¿y usun±æ

\subsection{Charakterystyka projektu}

Zaproponowany temat projektu obejmowa³ zagadnieniami z dziedziny nie powi±zanej z naszym kierunkiem studiów. Praca ma te¿ w pewnym stopniu charakter eksperymentalny, gdy¿ nie jest udokumentowane w jakim stopniu metody uczenia maszynowego maj± zastosowanie w predykcji arytmii serca na podstawie samego wykresu EKG. Wiele czasu po¶wiêcili¶my na testowanie skuteczno¶ci predykcji ró¿nych modeli sieci. Dodatkowo musieli¶my te¿ zbadaæ wp³yw parametrów danych wej¶ciowych, takich jak d³ugo¶æ fragmentu EKG na wej¶ciu, okres w którym staramy siê przewidzieæ wyst±pienie arytmii, jak i stopieñ redukcji szumów czy interpolacja danych do mniejszych czêstotliwo¶ci. 

Dodatkowo aby predykcja by³a mo¿liwa musimy mieæ oznaczone dane treningowe, na których bêdziemy mogli trenowaæ nasz± sieæ. Jednak ciê¿ko znale¼æ ogólnodostêpne dane, które spe³nia³yby to wymaganie. Wykorzystali¶my bazê, któr± zaproponowa³ nam promotor. Ze wzglêdu na niedu¿y rozmiar danych, starali¶my siê w pe³ni wykorzystaæ u¿ywan± przez nas bazê danych.

\subsection{Struktura zespo³u i role}

W sk³ad zespo³u wchodzi³o 2 studentów Informatyki. Starali¶my siê w miarê równo podzieliæ siê zadaniami. 
% TODO dodaæ uzasadnienie
\begin{itemize}
	\item \textbf{Tomasz Nizio}	
	
	Implementacja redukcja szumów o niskich czêstotliwo¶ciach przy pomocy FFT, projekt ca³ego interfejsu graficznego, prze³±czanie pomiêdzy widokami, rysowanie wykresu EKG oraz nawigacja po nim, wy¶wietlanie wyników oraz logów predykcji
	\item  \textbf{Konrad Dobro¶}
	
	Implementacja pobierania bazy z sieci, wczytywania, interpolacji oraz normalizacji danych, podzia³ danych na treningowe i testowe, struktura silnika predykcji, testowanie ró¿nych modeli siec neuronowych, dobór parametrów wej¶cia
	
\end{itemize}

Wspólnie zajmowali¶my siê wyszukiwaniem informacji przydatnych w rozwoju projektu, tworzeniem prymitywnego prototypu, pisaniem testów dla elementów które stworzyli¶my, a tak¿e tworzeniem dokumentacji.
Dodatkowo za ka¿dym razem recenzowali¶my siê nawzajem w sprawie wprowadzanych zmian.

\subsection{Etapy przebiegu pracy}

Prace nad projektem przebiega³y dosyæ nieregularnie. Pod koniec semestru letniego uda³o siê uzyskaæ prototyp o minimalnej funkcjonalno¶ci. W trakcie przerwy semestralnej prace nad projektem spowolni³y. Najwiêksza czê¶æ projektu powsta³a w trakcie semestru zimowego. 

Wyszczególniæ mo¿emy nastêpuj±ce etapy prac:


\subsubsection{Zapoznanie z tematyk± projektu oraz konfiguracja ¶rodowiska}

Czas trwania: 03.2018 - 04.2018
\newline
Osi±gniête cele:
\begin{itemize}
	\item zapoznanie siê z pojêciem arytmii, na czym polega, jak mo¿na j± wykrywaæ
	\item zapoznanie siê z postaci± wykresu EKG, co dok³adnie przedstawia
	\item zapoznanie siê z dzia³aniem sieci neuronowych oraz jak mo¿na j± wykorzystaæ do przewidywania wyst±pienia arytmii
	\item utworzenie ¶rodowiska - repozytorium, CI, narzêdzia organizacji pracy
	\item research technologii
\end{itemize}

\subsubsection{Zintegrowanie bazy danych}

Czas trwania: 04.2018 - 05.2018
\newline
Osi±gniête cele:
\begin{itemize}
	\item zapoznanie siê ze struktur± wykorzystywanej bazy EKG
	\item pobranie bazy danych
	\item wyodrêbnienie wymaganych danych z bazy
\end{itemize}

\subsubsection{Stworzenie prototypu}

Czas trwania: 05.2018 - 06.2018
\newline
Osi±gniête cele:
\begin{itemize}
	\item stworzenie prostego modelu sieci
	\item okre¶lenie formatu danych na wej¶ciu sieci neuronowej
	\item implementacja podstawowych operacji na danych
	\item przygotowanie danych dla takiego modelu
	\item przetestowanie dzia³ania przygotowanej sieci
\end{itemize}

\subsubsection{Struktura projektu oraz interfejsu}

Czas trwania: 07.2018 - 09.2018
\newline
Osi±gniête cele:
\begin{itemize}
	\item wyodrêbnienie w projekcie poszczególnych modu³ów
	\item okre¶lenie architektury modelu predykcji
	\item wstêpny projekt interfejsu graficznego
\end{itemize}

\subsubsection{Implementacja interfejsu oraz testy innych modeli sieci}

Czas trwania: 09.2018 - 10.2018
\newline
Osi±gniête cele:
\begin{itemize}
	\item implementacja podstawowego interfejsu graficznego
	\item redukcja szumów o niskich czêstotliwo¶ciach na przebiegu EKG
	\item stworzenie bardziej rozbudowanego modelu sieci neuronowej
	\item testy skuteczno¶ci predykcji z ró¿nymi parametrami
\end{itemize}

\subsubsection{Po³±czenie interfejsu z silnikiem predykcji}

Czas trwania: 10.2018 - 11.2018
\newline
Osi±gniête cele:
\begin{itemize}
	\item integracja modelu z interfejsem
	\item wytrenowanie ostatecznych sieci neuronowych
	\item dodanie informacji o arytmiach
\end{itemize}

\subsubsection{Poprawki oraz dokumentacja}

Czas trwania: 11.2018 - 12.2018
\newline
Osi±gniête cele:
\begin{itemize}
	\item poprawki interfejsu
	\item poprawki modelu
	\item stworzenie dokumentacji
\end{itemize}

\subsection{Wykorzystane narzêdzia}

Do zarz±dzania poszczególnymi zadaniami i ca³ym projektem wykorzystali¶my aplikacje webow± \textbf{Trello}. Do komunikacji w zespole wykorzystywali¶my komunikator \textbf{Slack}, którego zintegrowali¶my z narzêdziem \textbf{GitHub} co sprawi³o ¿e na kana³ wysy³ane by³y informacje o zmianach na repozytorium. Sporadycznie komunikowali¶my siê równie¿ przez \textbf{Skype}.

Kod wraz z dokumentacj± trzymali¶my w repozytorium \textbf{Git} na platformie \textbf{GitHub}. Do jego tworzenia wykorzystywali¶my miêdzy innymi takie narzêdzia jak \textbf{PyCharm} oraz \textbf{JupyterNotebook}, którego pliki zosta³y zaimportowane do projektu.

%TODO KD dopisz tu co¶ dlaczego korzysta³e¶ z Jupytera(³adnie wygl±da itd.) oraz inne istotne narzêdzia(proste edytory tekstu chyba nie s± istotne)

Przy tworzeniu interfejsu pomocy by³ równie¿ program \textbf{QtDesigner}

\section{\SectionTitleResults}
\label{sec:wyniki-projektu}
\emph{Wskazanie wyników projektu (co konkretnie uda³o siê uzyskaæ:
  oprogramowanie, dokumentacja, raporty z testów/wdro¿enia, itd.), prezentacja wyników
  i ocena ich u¿yteczno¶ci (jak zosta³o to zweryfikowane --- np.\ wnioski
  klienta/u¿ytkownika, zrealizowane testy wydajno¶ciowe, itd.),
  istniej±ce ograniczenia i propozycje dalszych prac.}  % niniejsza linijka to tylko komentarz, który nale¿y usun±æ

% o ile to mo¿liwe proszê uzywaæ odwo³añ \cite w konkretnych miejscach a nie \nocite

\nocite{artykul2011,ksiazka2011,narzedzie2011,projekt2011}

\bibliography{bibliografia}

\end{document}
